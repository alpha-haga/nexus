# nexus-accounting

## 役割

**唯一、会計仕訳を作成してよいドメイン**。

業務ドメインからの会計イベント（Fact）を受け取り、仕訳として記録する。

- **勘定科目管理**: 勘定科目マスタの管理
- **仕訳作成**: Fact から仕訳への変換
- **月次処理**: 締め処理・仕訳確定

## 他ドメインとの関係

| ドメイン | 関係 | 説明 |
|---------|------|------|
| gojo | Fact 受信 | 契約・積立の会計イベント |
| funeral | Fact 受信 | 葬祭売上・原価の会計イベント |
| payment | Fact 受信 | 入金・支払の会計イベント |
| agent | Fact 受信 | 報酬の会計イベント |
| reporting | データ提供 | 会計データの集計・分析用 |

## やってはいけないこと

| 禁止事項 | 理由 |
|---------|------|
| 業務ロジックの実装 | 契約・案件管理は各業務ドメインで |
| 入金処理の実行 | 入金管理は payment の責務 |
| 業務データの直接参照 | Fact 経由でのみ情報を受け取る |
| identity / household の更新 | 顧客マスタ更新は identity の責務 |

## 設計方針

### Fact → 仕訳 の変換

```
業務ドメイン                    accounting
┌─────────────────┐          ┌─────────────────┐
│ gojo            │          │                 │
│ InstallmentFact │─────────▶│ 積立仕訳        │
└─────────────────┘          │ (借)現金 xxx    │
                             │ (貸)前受金 xxx  │
┌─────────────────┐          │                 │
│ funeral         │          │                 │
│ SalesFact       │─────────▶│ 売上仕訳        │
└─────────────────┘          │ (借)売掛金 xxx  │
                             │ (貸)売上 xxx    │
┌─────────────────┐          │                 │
│ payment         │          │                 │
│ PaymentFact     │─────────▶│ 入金仕訳        │
└─────────────────┘          │ (借)現金 xxx    │
                             │ (貸)売掛金 xxx  │
                             └─────────────────┘
```

### 月次処理

```kotlin
// 仕訳確定は月次処理で行う
// 日次では仮仕訳として記録
interface MonthlyClosingService {
    fun closeMonth(yearMonth: YearMonth)
    // TODO: 実装は将来
}
```

## 依存関係

```
nexus-accounting
    └── nexus-core （ID, VO, 例外）
```

## 連携インターフェース

```kotlin
// 業務ドメインとの連携点（将来実装）
interface AccountingEventReceiver {
    fun receive(fact: AccountingFact)
}

// TODO: 実際のイベント基盤は将来実装
// 現時点では interface 定義のみ
```

## 注意事項

- 仕訳生成ロジックの実装は将来
- 現時点ではパッケージ構成と README による設計固定のみ
- 勘定科目マスタは別途設計が必要
