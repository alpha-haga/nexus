# Cursor 出力規約（NEXUS / P2-5 以降 共通）

## 0. 本規約の位置づけ（最重要）

本規約は **NEXUS プロジェクトにおいて Cursor / AI に作業を委任する際の  
「出力フォーマットと品質を固定するための正本」**である。

- 省略・要約・差分のみの出力は禁止
- 人間レビュー・設計引き継ぎ・障害調査に耐えることを最優先とする
- 本規約に反する出力は **未完了（NG）** とみなす

---

## 1. 適用範囲

本規約は以下の作業に **必ず適用** する。

- Backend / Frontend の実装修正
- SQL 以外の追従実装（DTO / RowMapper / 型 / 表示）
- P2-5 以降の Wave 作業
- Cursor による自動修正・一括修正

※ SQL の設計判断そのものは別規約に従う

---

## 2. 出力フォーマット（厳守・順序固定）

### ① 追加・変更ファイル一覧（必須・先頭）

- 追加・変更・削除の別が分かるように列挙する
- 1ファイル = 1行
- 何をしたかを **一言で**書く（曖昧表現禁止）

**例**

```
追加・変更ファイル一覧

backend/.../GroupContractRowMapper.kt : prefName / cityTownName のマッピング追加

backend/.../GroupContractSearchDto.kt : 住所項目追加

frontend/.../GroupContractsList.tsx : 都道府県・市区町村列を追加
```

---

### ② 変更ファイルの unified diff（必須）

- **git diff 形式（unified diff）**で出力する
- パス付きで、可能な限り以下の形式を守る

```
diff --git a/path/to/file b/path/to/file
index xxxx..yyyy 100644
--- a/path/to/file
+++ b/path/to/file
@@ -xx,yy +xx,yy @@
```

- diff は **変更ファイルすべて**について出す
- diff だけで変更点が追えること

---

### ③ 各ファイルの全文（必須）

- **変更ファイルは必ず全文提示**
- 一部抜粋・省略は禁止
- ファイルごとに区切って提示する

**例**

```
--- GroupContractRowMapper.kt ---
<全文>

--- GroupContractSearchDto.kt ---
<全文>
```

---

### ④ 次に何をするか（必須・1行）

- 今回の作業完了後、**次の具体的アクションを1行で明示**
- 曖昧な表現（「検討する」「様子を見る」）は禁止

**例**

```
次に何をするか:
住所 JOIN 拡張（zip / oaza / aza）Wave 2 に進む
```

---

## 3. 出力内容の品質ルール

### 3.1 禁止事項
- ついで修正
- フォーマット変更のみのコミット
- 意味の変わるリファクタリング
- 既存仕様・命名の勝手な変更
- 「多分」「想定」「一般的には」などの推測

### 3.2 責務境界
- Frontend は業務判断をしない
- Backend は UI 表示都合に寄せない
- NULL → 表示変換（`-` 等）は **表示層のみ**

---

## 4. 不明点の扱い

- 不明点がある場合のみ **質問は最大1つ**
- 質問が発生した時点で **作業を止める**
- 推測で進めることは禁止

---

## 5. 完了条件（Done）

以下をすべて満たして **Done** とする。

- 出力フォーマット①〜④をすべて満たしている
- ビルドが通る（該当範囲）
- search / count / 表示の整合が壊れていない
- 設計憲法・フェーズ前提に違反していない

---

## 6. 運用メモ

- 本規約は Cursor プロンプトの末尾に貼り付けて使用する
- diff + 全文を併記することで、後日の設計追跡を可能にする
- チャットが重くなった場合は「規約＋結果のみ」を新チャットに貼る

---
