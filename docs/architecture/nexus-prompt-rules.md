# NEXUS Prompt Rules（Cursor / Agent 実行規約）

本ドキュメントは、NEXUS プロジェクトにおいて **ChatGPT / Cursor / Agent** を用いて作業を行う際の
**プロンプト設計・実行・結果確認の共通ルール**を定義する。

本規約は以下を目的とする：

* 引き継ぎチャット間での設計ブレ防止
* Cursor 実行結果の品質安定
* 「考え方」「判断基準」「禁止事項」を AI に正確に伝える

---

## 1. 前提ドキュメント（必須）

すべてのプロンプト実行は、以下 docs を**前提として読むこと**。

* `docs/nexus-design-constitution.md`

  * 設計憲法・思想・禁止事項
* `docs/nexus-project-roadmap.md`

  * 全体ロードマップ（P0〜P2）と現在地（P04）
* `docs/nexus-prompt-rules.md`（本書）

👉 プロンプト本文中に **「上記 docs を前提とする」** と必ず明記する。

---

## 2. プロンプト構造ルール（必須）

### 2.1 親プロンプト（引き継ぎ用）

用途：

* 新チャット開始時
* 他 AI / 他セッションへの完全引き継ぎ

特徴：

* 設計思想・ロードマップ・現在地をすべて含む
* 実装指示は含めない
* **このプロンプト単体で NEXUS を誤解なく理解できること**

---

### 2.2 子プロンプト（作業用）

用途：

* 特定フェーズ（例：P04-3）の実装作業
* Cursor / Agent 実行

必須構成：

1. 前提
2. 今回の目的
3. 作業範囲（やること / やらないこと）
4. 成果物定義
5. 出力ルール

---

## 3. Cursor / Agent 実行ルール

### 3.1 出力形式の指定

**必ずプロンプトで指定すること**：

* `diff のみ` か `全文` か、または `両方`
* 複数ファイルの場合は **ファイル単位で明示**

例：

```
- 修正は diff 形式で出力
- 新規ファイルは全文を出力
```

---

### 3.2 禁止事項（重要）

* 設計思想の再解釈・言い換え
* docs に書かれていない独自判断の追加
* 勝手な命名規則変更
* SQL / DTO / API の責務越境

👉 不明点がある場合は **質問してから止まる**。勝手に進めない。

---

## 4. SQL / DTO / RowMapper ルール（再掲）

* SQL が正（Single Source of Truth）
* SQL alias：`lower_snake_case`（省略しない）
* Kotlin DTO：`lowerCamelCase`
* 変換は RowMapper に集約（自動マッピング禁止）

---

## 5. Profile / 切替ルール

* JDBC 実装：`@Profile("jdbc")`
* JPA MIN：`@Profile("!jdbc")`
* Controller も同様に profile で明示的に切替

---

## 6. 作業完了条件（Done 定義）

各作業フェーズでは以下を必ず満たすこと：

* `./gradlew build` が成功
* 想定 profile で `bootRun` が起動
* 設計憲法・ロードマップとの矛盾がない

---

## 7. 引き継ぎ時の推奨手順（再確認）

新しいチャットを開始する際は、以下順で行う：

1. GitHub 最新 zip を添付
2. 親プロンプト（NEXUS 全体・設計憲法 / 引き継ぎ用）を貼付
3. 子プロンプト（作業フェーズ専用）を貼付

---

## 8. 本ドキュメントの位置づけ

* 本書は **運用ルール**であり設計憲法ではない
* 設計判断は `nexus-design-constitution.md` を最優先
* 本書は必要に応じて更新可（判断基準は常に明文化）

---

以上
