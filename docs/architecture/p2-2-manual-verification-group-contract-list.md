# P2-2: Group Contract List 手動検証手順

本ドキュメントは、P2-2（Frontend 本格接続）における Group Contract List 画面の手動検証手順を定義する。

## 検証項目

### 1. Region未設定時の動作

#### 1.1 初期表示
- [ ] 画面を開いた時、Region セレクターが表示される
- [ ] Region が未選択の状態で、検索フォームが disabled になっている
- [ ] 「Region を選択してください。Region が選択されていない場合、検索は実行できません。」というメッセージが表示される
- [ ] 検索ボタンが disabled になっている

#### 1.2 Region未設定時の検索試行
- [ ] Region 未選択の状態で検索ボタンをクリックしても、API が呼ばれないことを確認
  - ブラウザの開発者ツールの Network タブで確認
  - `/api/v1/group/contracts/search` へのリクエストが発生しないことを確認

### 2. Region設定後の動作

#### 2.1 Region選択
- [ ] Region セレクターから「統合DB」「埼玉」「福島」「栃木」のいずれかを選択できる
- [ ] Region を選択すると、検索フォームが enabled になる
- [ ] Region を選択すると、それまでの検索結果・エラーがクリアされる
- [ ] Region を変更すると、検索結果・エラーがクリアされる

#### 2.2 検索実行
- [ ] Region を選択後、検索条件を入力して「検索」ボタンをクリック
- [ ] API リクエストに `X-NEXUS-REGION` ヘッダーが付与されていることを確認
  - ブラウザの開発者ツールの Network タブで確認
  - ヘッダーの値が選択した Region と一致することを確認
- [ ] 検索中は「検索中...」が表示される
- [ ] 検索結果が正しく表示される

### 3. 検索結果表示

#### 3.1 検索結果あり
- [ ] 検索結果が1件以上の場合、テーブルに結果が表示される
- [ ] 全件数が正しく表示される
- [ ] ページネーション情報が正しく表示される（例: "100件中 1-20件を表示"）

#### 3.2 検索結果0件
- [ ] 検索結果が0件の場合、「検索条件に該当する契約が見つかりませんでした」が表示される
- [ ] エラーメッセージは表示されない

### 4. ページング動作

#### 4.1 ページサイズ変更
- [ ] ページサイズ（20/50/100）を変更できる
- [ ] ページサイズ変更時、ページが0にリセットされる
- [ ] ページサイズ変更時、新しい検索が実行される
- [ ] ページサイズ変更後、正しい件数が表示される

#### 4.2 ページ移動
- [ ] 「前へ」「次へ」ボタンでページ移動できる
- [ ] 最初のページでは「前へ」ボタンが disabled になる
- [ ] 最後のページでは「次へ」ボタンが disabled になる
- [ ] ページ移動時、新しい検索が実行される
- [ ] ページ番号が正しく表示される（例: "1 / 5"）

### 5. エラーハンドリング

#### 5.1 400 Bad Request
- [ ] バリデーションエラー（例: page < 0, size > 100）の場合、400エラーが表示される
- [ ] エラーメッセージに「バリデーションエラー:」というプレフィックスが付く
- [ ] エラーコードが表示される（存在する場合）
- [ ] 相関IDが表示される（存在する場合）

**再現手順（例）**:
1. Region を選択
2. ブラウザの開発者ツールの Console で以下を実行:
   ```javascript
   // 手動で不正なリクエストを送信（実際のAPIがバリデーションを返す場合）
   ```
   または、バックエンドで意図的に400を返すように設定

#### 5.2 403 Forbidden
- [ ] 権限エラーの場合、403エラーが表示される
- [ ] エラーメッセージに「権限エラー:」というプレフィックスが付く

**再現手順（例）**:
1. Region を選択
2. バックエンドで意図的に403を返すように設定
3. 検索を実行

#### 5.3 404 Not Found
- [ ] リソースが見つからない場合、404エラーが表示される
- [ ] エラーメッセージに「リソースが見つかりません:」というプレフィックスが付く

**再現手順（例）**:
1. Region を選択
2. バックエンドで意図的に404を返すように設定
3. 検索を実行

#### 5.4 500 Internal Server Error
- [ ] サーバーエラーの場合、500エラーが表示される
- [ ] エラーメッセージに「サーバーエラー:」というプレフィックスが付く
- [ ] ネットワークエラーの場合も500エラーとして表示される

**再現手順（例）**:
1. Region を選択
2. バックエンドを停止するか、意図的に500を返すように設定
3. 検索を実行

### 6. 状態管理

#### 6.1 初期表示
- [ ] 画面を開いた時、検索は実行されない（hasSearched = false）
- [ ] 「検索条件を入力して「検索」ボタンをクリックしてください」が表示される

#### 6.2 Region変更時の状態リセット
- [ ] Region を変更すると、以下の状態がリセットされる:
  - result = null
  - error = null
  - searchState = 'not-started'
  - page = 0
  - hasSearched = false

#### 6.3 Stale State 防止
- [ ] loadContracts は引数で確定値を渡している（state を直接参照していない）
- [ ] setPage/setSize の直後に loadContracts を呼ぶ場合、引数で newPage/newSize を渡している

## 検証環境

- Frontend: `http://localhost:3000` (想定)
- Backend: `http://localhost:8080` (想定)
- API Base URL: `/api/v1`

## 検証時の注意事項

1. ブラウザの開発者ツール（Network タブ、Console タブ）を開いて検証する
2. エラーレスポンスの確認は、バックエンドのログも参照する
3. Region の切り替え時は、必ず状態がリセットされることを確認する
4. ページング動作時は、API リクエストが正しく送信されることを確認する

## トラブルシューティング

### API が呼ばれない
- Region が選択されているか確認
- ブラウザの開発者ツールの Console でエラーが出ていないか確認

### エラーが表示されない
- ブラウザの開発者ツールの Network タブで、実際のレスポンスを確認
- バックエンドのログを確認

### ページングが動作しない
- hasSearched が true になっているか確認
- Region が選択されているか確認
